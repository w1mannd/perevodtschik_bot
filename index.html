<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Русско-сингонский переводчик</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; padding: 0; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        const tg = window.Telegram?.WebApp;
        if (tg) {
            tg.expand();
            tg.ready();
            document.body.style.backgroundColor = tg.themeParams.bg_color || '#1a1a2e';
        }

        // Компонент звезды - использует ваш файл из репозитория
        const StarIcon = ({ className }) => (
            <img 
                src="syngonian_star.png" 
                alt="Звезда Сингонии"
                className={className}
                style={{ objectFit: 'contain' }}
            />
        );

        const SlingonTranslator = () => {
            const [inputText, setInputText] = useState('');
            const [outputText, setOutputText] = useState('');
            const [mode, setMode] = useState('ru-sl');

            // Таблица замены букв
            const letterMap = {
                'а': 'ә', 'б': 'к', 'в': 'у', 'г': 'х', 'д': 'г', 'е': 'э', 'ё': 'йо',
                'ж': 'й', 'з': 'р', 'и': 'ы', 'й': 'й', 'к': 'ч', 'л': 'ф', 'м': 'ц',
                'н': 'н', 'о': 'ү', 'п': 'м', 'р': 'н', 'с': 'з', 'т': 'ш', 'у': 'о',
                'ф': 'п', 'х': 'ж', 'ц': 'н', 'ч': 'т', 'ш': 'с', 'щ': 'б', 'ъ': '',
                'ы': 'и', 'ь': '', 'э': 'и', 'ю': 'а', 'я': 'у',
                'А': 'Ә', 'Б': 'К', 'В': 'У', 'Г': 'Х', 'Д': 'Г', 'Е': 'Э', 'Ё': 'Йо',
                'Ж': 'Й', 'З': 'Р', 'И': 'Ы', 'Й': 'Й', 'К': 'Ч', 'Л': 'Ф', 'М': 'Ц',
                'Н': 'Н', 'О': 'Ү', 'П': 'М', 'Р': 'Н', 'С': 'З', 'Т': 'Ш', 'У': 'О',
                'Ф': 'П', 'Х': 'Ж', 'Ц': 'Н', 'Ч': 'Т', 'Ш': 'С', 'Щ': 'Б', 'Ъ': '',
                'Ы': 'И', 'Ь': '', 'Э': 'И', 'Ю': 'А', 'Я': 'У'
            };

            const reverseLetterMap = {};

            useEffect(() => {
                Object.keys(letterMap).forEach(key => {
                    const value = letterMap[key];
                    if (value && value !== '') {
                        reverseLetterMap[value] = key;
                    }
                });
            }, []);

            const preserveCase = (originalWord, translatedWord) => {
                if (!originalWord || !translatedWord) return translatedWord;
                
                if (originalWord === originalWord.toUpperCase()) {
                    return translatedWord.toUpperCase();
                }
                
                if (originalWord[0] === originalWord[0].toUpperCase()) {
                    return translatedWord.charAt(0).toUpperCase() + translatedWord.slice(1);
                }
                
                return translatedWord;
            };

            const convertWord = (word) => {
                let result = '';
                for (let char of word) {
                    result += letterMap[char] || char;
                }
                return result;
            };

            const convertWordReverse = (word) => {
                let result = '';
                let i = 0;
                while (i < word.length) {
                    if (i < word.length - 1) {
                        const twoChar = word[i] + word[i + 1];
                        if (reverseLetterMap[twoChar]) {
                            result += reverseLetterMap[twoChar];
                            i += 2;
                            continue;
                        }
                    }
                    result += reverseLetterMap[word[i]] || word[i];
                    i++;
                }
                return result;
            };

            const translateToSlingon = (text) => {
                const sentences = text.split(/([.!?]\s*)/);
                let result = '';
                
                for (let sentence of sentences) {
                    if (/[.!?]/.test(sentence)) {
                        result += sentence;
                        continue;
                    }
                    
                    const words = sentence.split(/(\s+|[,;:])/);
                    let translatedSentence = '';
                    
                    for (let token of words) {
                        if (/\s+|[,;:]/.test(token)) {
                            translatedSentence += token;
                            continue;
                        }
                        
                        if (!token) continue;
                        
                        if (/^\d+$/.test(token)) {
                            translatedSentence += token;
                            continue;
                        }
                        
                        if (token.startsWith('*') && token.endsWith('*') && token.length > 2) {
                            translatedSentence += token.slice(1, -1);
                            continue;
                        }
                        
                        const translated = convertWord(token);
                        translatedSentence += preserveCase(token, translated);
                    }
                    
                    result += translatedSentence;
                }
                
                return result;
            };

            const translateFromSlingon = (text) => {
                const sentences = text.split(/([.!?]\s*)/);
                let result = '';
                
                for (let sentence of sentences) {
                    if (/[.!?]/.test(sentence)) {
                        result += sentence;
                        continue;
                    }
                    
                    const words = sentence.split(/(\s+|[,;:])/);
                    let translatedSentence = '';
                    
                    for (let token of words) {
                        if (/\s+|[,;:]/.test(token)) {
                            translatedSentence += token;
                            continue;
                        }
                        
                        if (!token) continue;
                        
                        if (/^\d+$/.test(token)) {
                            translatedSentence += token;
                            continue;
                        }
                        
                        const translated = convertWordReverse(token);
                        translatedSentence += preserveCase(token, translated);
                    }
                    
                    result += translatedSentence;
                }
                
                return result;
            };

            const handleTranslate = () => {
                if (!inputText.trim()) {
                    setOutputText('');
                    return;
                }
                
                if (mode === 'ru-sl') {
                    setOutputText(translateToSlingon(inputText));
                } else {
                    setOutputText(translateFromSlingon(inputText));
                }
            };

            const swapLanguages = () => {
                setMode(mode === 'ru-sl' ? 'sl-ru' : 'ru-sl');
                setInputText(outputText);
                setOutputText(inputText);
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-4">
                    <div className="max-w-4xl mx-auto mb-6">
                        <div className="backdrop-blur-xl bg-white/10 rounded-3xl p-4 md:p-6 shadow-2xl border border-white/20">
                            <div className="flex items-center justify-center gap-3">
                                <div className="flex items-center gap-2 md:gap-3 flex-1 min-w-0">
                                    <StarIcon className="w-6 h-6 md:w-8 md:h-8 flex-shrink-0" />
                                    <h1 className="text-lg md:text-2xl font-bold text-white truncate">Русско-сингонский переводчик</h1>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-4xl mx-auto">
                        <div className="backdrop-blur-xl bg-white/10 rounded-3xl p-6 shadow-2xl border border-white/20">
                            <div className="flex items-center justify-center gap-4 mb-6">
                                <div className="backdrop-blur-md bg-white/20 px-6 py-2 rounded-xl border border-white/20">
                                    <span className="text-white font-medium">
                                        {mode === 'ru-sl' ? 'Русский' : 'Сингонский'}
                                    </span>
                                </div>
                                <button
                                    onClick={swapLanguages}
                                    className="backdrop-blur-md bg-white/20 hover:bg-white/30 p-3 rounded-xl transition-all border border-white/20"
                                >
                                    <StarIcon className="w-5 h-5" />
                                </button>
                                <div className="backdrop-blur-md bg-white/20 px-6 py-2 rounded-xl border border-white/20">
                                    <span className="text-white font-medium">
                                        {mode === 'ru-sl' ? 'Сингонский' : 'Русский'}
                                    </span>
                                </div>
                            </div>

                            <div className="mb-4">
                                <textarea
                                    value={inputText}
                                    onChange={(e) => setInputText(e.target.value)}
                                    placeholder="Введите текст для перевода..."
                                    className="w-full h-40 backdrop-blur-md bg-white/20 text-white placeholder-white/60 rounded-2xl p-4 border border-white/20 focus:outline-none focus:ring-2 focus:ring-white/40 resize-none"
                                />
                            </div>

                            <button
                                onClick={handleTranslate}
                                className="w-full backdrop-blur-md bg-gradient-to-r from-purple-500 to-blue-500 hover:from-purple-600 hover:to-blue-600 text-white font-semibold py-4 rounded-2xl transition-all shadow-lg mb-4"
                            >
                                Перевести
                            </button>

                            <div className="backdrop-blur-md bg-white/20 rounded-2xl p-4 border border-white/20 min-h-[160px]">
                                <p className="text-white whitespace-pre-wrap">{outputText || 'Перевод появится здесь...'}</p>
                            </div>
                        </div>
                    </div>

                    <div className="max-w-4xl mx-auto mt-6 text-center">
                        <p className="text-white/70 text-sm mb-2">
                            При поддержке Национального института сингонского языка
                        </p>
                        <StarIcon className="w-6 h-6 mx-auto opacity-60" />
                    </div>
                </div>
            );
        };

        // Рендерим приложение
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SlingonTranslator />);
    </script>
</body>
</html>
